<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOD Frontend Test</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #4fc3f7;
      border-bottom: 2px solid #4fc3f7;
      padding-bottom: 10px;
    }
    
    .section {
      background: #252526;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border-left: 4px solid #4fc3f7;
    }
    
    .test-result {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: monospace;
    }
    
    .success {
      background: #1e4620;
      border-left: 4px solid #4caf50;
    }
    
    .error {
      background: #5a1e1e;
      border-left: 4px solid #f44336;
    }
    
    .warning {
      background: #5a4a1e;
      border-left: 4px solid #ff9800;
    }
    
    .info {
      background: #1e3a5a;
      border-left: 4px solid #2196f3;
    }
    
    button {
      background: #4fc3f7;
      color: #000;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    
    button:hover {
      background: #29b6f6;
    }
    
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    
    #output {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    .code {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç HOD Routes Frontend Test</h1>
    
    <div class="section">
      <h2>Configuration</h2>
      <div class="info test-result">
        <strong>Backend URL:</strong> http://localhost:3000<br>
        <strong>HOD Credentials:</strong> examplemail@gmail.com / T001
      </div>
    </div>
    
    <div class="section">
      <h2>Actions</h2>
      <button onclick="testLogin()">1. Test Login</button>
      <button onclick="testAllRoutes()" id="testAllBtn" disabled>2. Test All HOD Routes</button>
      <button onclick="testFrontendImport()">3. Test Frontend Component</button>
      <button onclick="clearOutput()">Clear Output</button>
    </div>
    
    <div class="section">
      <h2>Test Results</h2>
      <div id="output"></div>
    </div>
  </div>

  <script>
    let authToken = null;
    const BASE_URL = 'http://localhost:3000';
    
    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const div = document.createElement('div');
      div.className = `test-result ${type}`;
      div.innerHTML = message;
      output.appendChild(div);
      output.scrollTop = output.scrollHeight;
    }
    
    function clearOutput() {
      document.getElementById('output').innerHTML = '';
    }
    
    async function testLogin() {
      log('üîê Testing HOD Login...', 'info');
      
      try {
        const response = await fetch(`${BASE_URL}/api/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email: 'examplemail@gmail.com',
            password: 'T001'
          })
        });
        
        const data = await response.json();
        
        if (data.success && data.token) {
          authToken = data.token;
          log(`‚úÖ Login successful<br>` +
              `   Token: ${authToken.substring(0, 30)}...<br>` +
              `   User: ${data.user.email}<br>` +
              `   Role: ${data.user.role}`, 'success');
          
          document.getElementById('testAllBtn').disabled = false;
        } else {
          log(`‚ùå Login failed: ${data.message || 'Unknown error'}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Login error: ${error.message}`, 'error');
      }
    }
    
    async function testRoute(method, path, description) {
      try {
        const response = await fetch(`${BASE_URL}${path}`, {
          method: method,
          headers: {
            'Authorization': `Bearer ${authToken}`,
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          let dataInfo = '';
          if (data.data) {
            if (Array.isArray(data.data)) {
              dataInfo = `<br>   Data: Array with ${data.data.length} items`;
            } else {
              dataInfo = `<br>   Data: Object`;
            }
          }
          
          log(`‚úÖ ${description}<br>` +
              `   Status: ${response.status}<br>` +
              `   Success: ${data.success}${dataInfo}`, 'success');
          return true;
        } else {
          log(`‚ùå ${description}<br>` +
              `   Status: ${response.status}<br>` +
              `   Error: ${data.message || 'Unknown error'}`, 'error');
          return false;
        }
      } catch (error) {
        log(`‚ùå ${description}<br>` +
            `   Error: ${error.message}`, 'error');
        return false;
      }
    }
    
    async function testAllRoutes() {
      if (!authToken) {
        log('‚ùå Please login first!', 'error');
        return;
      }
      
      log('üöÄ Testing all HOD routes...', 'info');
      
      const routes = [
        { method: 'GET', path: '/api/hod/overview', description: 'Overview Statistics' },
        { method: 'GET', path: '/api/hod/top-performers/cgpa', description: 'Top Performers (CGPA)' },
        { method: 'GET', path: '/api/hod/top-performers/cgpa?limit=5', description: 'Top 5 Performers' },
        { method: 'GET', path: '/api/hod/top-performers/total-marks', description: 'Top Performers (Total Marks)' },
        { method: 'GET', path: '/api/hod/batch-statistics', description: 'Batch Statistics' },
        { method: 'GET', path: '/api/hod/subject-analytics', description: 'Subject Analytics' },
        { method: 'GET', path: '/api/hod/section-comparison', description: 'Section Comparison' }
      ];
      
      let passed = 0;
      let failed = 0;
      
      for (const route of routes) {
        const success = await testRoute(route.method, route.path, route.description);
        if (success) passed++;
        else failed++;
        await new Promise(resolve => setTimeout(resolve, 100)); // Small delay between requests
      }
      
      log(`<br>üìä <strong>Test Summary:</strong><br>` +
          `   Total: ${routes.length}<br>` +
          `   ‚úÖ Passed: ${passed}<br>` +
          `   ‚ùå Failed: ${failed}`, 
          failed === 0 ? 'success' : 'warning');
    }
    
    function testFrontendImport() {
      log('üîç Checking Frontend Component Import...', 'info');
      
      const code = `// Check if HODDashboard component exists
// Open browser console (F12) and check:

1. Network Tab ‚Üí Check which HODDashboard.tsx file is loaded
2. Console Tab ‚Üí Look for "üöÄ NEW HOD DASHBOARD LOADING - VERSION 3.0 üöÄ"
3. Sources Tab ‚Üí Search for "HODDashboard" to see actual loaded code

If you see "Coming Soon" message:
   ‚ùå Old code is cached
   ‚úÖ Solution: Hard refresh (Ctrl+Shift+R) or clear browser cache

If navigation doesn't work:
   ‚ùå Check React Router in browser console
   ‚ùå Check ProtectedRoute component logs`;
      
      log(`<div class="code">${code}</div>`, 'info');
    }
  </script>
</body>
</html>
